<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ™®AI + MySQL é›†æˆ Demo</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        .result pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="display: flex; align-items: center; font-size: 2.8rem; font-weight: bold; margin: 0;">
                <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f916.png" alt="robot" style="width:48px;height:48px;margin-right:12px;vertical-align:middle;">
                å·¥å…·å¤§å…¨
            </h1>
        </div>

        <div class="content">
            <div class="tabs">
                <div class="tab active" onclick="showTab('demo')">ç³»ç»Ÿæ¼”ç¤º</div>
                <div class="tab" onclick="showTab('users')">ç”¨æˆ·ç®¡ç†</div>
                <div class="tab" onclick="showTab('ai')">AIæœåŠ¡</div>
                <div class="tab" onclick="showTab('tools')">å·¥å…·åŠŸèƒ½</div>
                <div class="tab" onclick="showTab('stock')">è‚¡ç¥¨åˆ†æ</div>
            </div>

            <!-- ç³»ç»Ÿæ¼”ç¤º -->
            <div id="demo" class="tab-content active">
                <div class="section">
                    <h2>ğŸš€ ç³»ç»ŸåŠŸèƒ½</h2>
                    <button class="btn" onclick="getSystemInfo()">è·å–ç³»ç»Ÿä¿¡æ¯</button>
                    <button class="btn" onclick="testDatabase()">æµ‹è¯•æ•°æ®åº“</button>
                    <button class="btn" onclick="analyzeAllUsers()">åˆ†æç”¨æˆ·æ•°æ®</button>
                    <div id="demo-result" class="result" style="display: none;"></div>
                </div>

                <div class="section">
                    <h2>âš¡ å¿«é€Ÿæµ‹è¯•</h2>
                    <div class="form-group">
                        <label>ç”¨æˆ·å:</label>
                        <input type="text" id="quick-username" value="æµ‹è¯•ç”¨æˆ·">
                    </div>
                    <div class="form-group">
                        <label>é‚®ç®±:</label>
                        <input type="email" id="quick-email" value="test@example.com">
                    </div>
                    <div class="form-group">
                        <label>æè¿°:</label>
                        <textarea id="quick-description" rows="3">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·</textarea>
                    </div>
                    <button class="btn" onclick="quickTest()">åˆ›å»ºç”¨æˆ·å¹¶åˆ†æ</button>
                    <div id="quick-result" class="result" style="display: none;"></div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="users" class="tab-content">
                <div class="section">
                    <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
                    <button class="btn" onclick="getAllUsers()">è·å–æ‰€æœ‰ç”¨æˆ·</button>
                    <button class="btn" onclick="initTestData()">åˆå§‹åŒ–æµ‹è¯•æ•°æ®</button>
                    <div id="users-result" class="result" style="display: none;"></div>
                </div>

                <div class="section">
                    <h2>â• åˆ›å»ºç”¨æˆ·</h2>
                    <div class="form-group">
                        <label>ç”¨æˆ·å:</label>
                        <input type="text" id="new-username">
                    </div>
                    <div class="form-group">
                        <label>é‚®ç®±:</label>
                        <input type="email" id="new-email">
                    </div>
                    <div class="form-group">
                        <label>æè¿°:</label>
                        <textarea id="new-description" rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="createUser()">åˆ›å»ºç”¨æˆ·</button>
                    <div id="create-result" class="result" style="display: none;"></div>
                </div>
            </div>

            <!-- AIæœåŠ¡ -->
            <div id="ai" class="tab-content">
                <div class="section">
                    <h2>ğŸ¤– æ™ºèƒ½æŸ¥è¯¢ï¼ˆæ¨èï¼‰</h2>
                    <p style="color: #666; margin-bottom: 15px;">æ™ºèƒ½æŸ¥è¯¢ä¼šè‡ªåŠ¨ä»æ•°æ®åº“è·å–ç›¸å…³ä¿¡æ¯ï¼Œæä¾›æ›´å‡†ç¡®çš„å›ç­”</p>
                    <div class="form-group">
                        <label>æŸ¥è¯¢å†…å®¹:</label>
                        <textarea id="smart-query" rows="4" placeholder="ä¾‹å¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ã€Javaå¼€å‘å·¥ç¨‹å¸ˆæœ‰å“ªäº›ã€å¼ ä¸‰çš„ä¿¡æ¯ç­‰">æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</textarea>
                    </div>
                    <button class="btn" onclick="smartQuery()">æ™ºèƒ½æŸ¥è¯¢</button>
                    <div id="smart-result" class="result" style="display: none;"></div>
                </div>

                <div class="section">
                    <h2>ğŸ’¬ æ™®é€šAIèŠå¤©</h2>
                    <div class="form-group">
                        <label>æ¶ˆæ¯:</label>
                        <textarea id="chat-message" rows="4">ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±</textarea>
                    </div>
                    <button class="btn" onclick="chatWithAI()">å‘é€æ¶ˆæ¯</button>
                    <div id="chat-result" class="result" style="display: none;"></div>
                </div>

                <div class="section">
                    <h2>ğŸ“Š AIæ•°æ®åˆ†æ</h2>
                    <div class="form-group">
                        <label>æ•°æ®:</label>
                        <textarea id="analyze-data" rows="6">ç”¨æˆ·æ•°æ®ç¤ºä¾‹ï¼š
å¼ ä¸‰ - Javaå¼€å‘å·¥ç¨‹å¸ˆ
æå›› - å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ</textarea>
                    </div>
                    <button class="btn" onclick="analyzeUserData()">åˆ†ææ•°æ®</button>
                    <div id="analyze-result" class="result" style="display: none;"></div>
                </div>
            </div>

            <!-- å·¥å…·åŠŸèƒ½ -->
            <div id="tools" class="tab-content">
                <div class="section">
                    <h2>ğŸ”„ æ¨¡å¼æ›¿æ¢é‡å‘½å</h2>
                    <p style="color: #666; margin-bottom: 15px;">å°†æ‰€æœ‰æ–‡ä»¶/æ–‡ä»¶å¤¹åä¸­åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„éƒ¨åˆ†æ›¿æ¢ä¸ºæ–°å­—ç¬¦ä¸²ï¼Œé€’å½’å¤„ç†æ‰€æœ‰å­ç›®å½•</p>
                    <div class="form-group">
                        <label>ç›®å½•ç»å¯¹è·¯å¾„:</label>
                        <input type="text" id="replace-dir-path" style="width: 80%;" placeholder="å¦‚ D:/test" />
                    </div>
                    <div class="form-group">
                        <label>åŒ¹é…å­—ç¬¦ä¸²:</label>
                        <input type="text" id="replace-pattern" style="width: 50%;" placeholder="å¦‚ _" />
                    </div>
                    <div class="form-group">
                        <label>æ›¿æ¢ä¸º:</label>
                        <input type="text" id="replace-replacement" style="width: 50%;" placeholder="å¦‚ -" />
                    </div>
                    <button class="btn" onclick="renameByReplacement()">æ‰¹é‡æ›¿æ¢é‡å‘½å</button>
                    <div id="replace-result" class="result" style="display: none;"></div>
                </div>
                
            </div>
            <!-- è‚¡ç¥¨åˆ†æ -->
            <div id="stock" class="tab-content">
                <div class="section">
                    <h2>ğŸ“ˆ è‚¡ç¥¨é€‰è‚¡</h2>
                    <button class="btn" onclick="getStockPicks()">ä¸€é”®é€‰è‚¡</button>
                    <div id="stock-pick-result" class="result" style="display: none;"></div>
                </div>
                <div class="section">
                    <h2>ğŸ›¡ï¸ é£æ§æ£€æµ‹</h2>
                    <div class="form-group">
                        <label>è‚¡ç¥¨ä»£ç :</label>
                        <input type="text" id="risk-code" placeholder="å¦‚ 000001.SZ">
                    </div>
                    <div class="form-group">
                        <label>ä¹°å…¥ä»·:</label>
                        <input type="number" id="risk-buy-price" placeholder="ä¹°å…¥ä»·">
                    </div>
                    <div class="form-group">
                        <label>ä¹°å…¥æ—¥æœ€ä½ä»·:</label>
                        <input type="number" id="risk-buy-low" placeholder="ä¹°å…¥æ—¥æœ€ä½ä»·">
                    </div>
                    <button class="btn" onclick="checkStockRisk()">é£æ§æ£€æµ‹</button>
                    <div id="stock-risk-result" class="result" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(128,128,128,0.35);backdrop-filter: blur(1px);"></div>

    <script>
        const API_BASE = 'http://localhost:8080';

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showOverlay() {
            document.getElementById('overlay').style.display = 'block';
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            document.querySelectorAll('button').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            });
        }
        function hideOverlay() {
            document.getElementById('overlay').style.display = 'none';
            // æ¢å¤æ‰€æœ‰æŒ‰é’®
            document.querySelectorAll('button').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            });
        }

        async function callAPI(url, method = 'GET', body = null) {
            showOverlay();
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (body && method !== 'GET') {
                    options.body = JSON.stringify(body);
                }
                const response = await fetch(API_BASE + url, options);
                const data = await response.json();
                return { success: response.ok, data: data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message, status: 0 };
            } finally {
                hideOverlay();
            }
        }

        function showResult(elementId, result, title) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            if (result.success) {
                element.innerHTML = `<h3>âœ… ${title}</h3><pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                element.innerHTML = `<h3>âŒ ${title}</h3><pre>${JSON.stringify(result.error || result.data, null, 2)}</pre>`;
            }
        }

        // ç³»ç»Ÿæ¼”ç¤ºåŠŸèƒ½
        async function getSystemInfo() {
            const result = await callAPI('/api/demo/info');
            showResult('demo-result', result, 'ç³»ç»Ÿä¿¡æ¯');
        }

        async function testDatabase() {
            const result = await callAPI('/api/demo/db-test');
            showResult('demo-result', result, 'æ•°æ®åº“æµ‹è¯•');
        }

        async function analyzeAllUsers() {
            const result = await callAPI('/api/demo/analyze-all-users');
            showResult('demo-result', result, 'ç”¨æˆ·æ•°æ®åˆ†æ');
        }

        async function quickTest() {
            const username = document.getElementById('quick-username').value;
            const email = document.getElementById('quick-email').value;
            const description = document.getElementById('quick-description').value;
            const body = { username, email, description };
            const result = await callAPI('/api/demo/quick-test', 'POST', body);
            showResult('quick-result', result, 'å¿«é€Ÿæµ‹è¯•');
        }

        // ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        async function getAllUsers() {
            const result = await callAPI('/api/users');
            showResult('users-result', result, 'æ‰€æœ‰ç”¨æˆ·');
        }

        async function initTestData() {
            const result = await callAPI('/api/users/init-test-data', 'POST');
            showResult('users-result', result, 'åˆå§‹åŒ–æµ‹è¯•æ•°æ®');
        }

        async function createUser() {
            const username = document.getElementById('new-username').value;
            const email = document.getElementById('new-email').value;
            const description = document.getElementById('new-description').value;
            const body = { username, email, description };
            const result = await callAPI('/api/users', 'POST', body);
            showResult('create-result', result, 'åˆ›å»ºç”¨æˆ·');
        }

        // AIæœåŠ¡åŠŸèƒ½
        async function smartQuery() {
            const message = document.getElementById('smart-query').value;
            const body = { message };
            const result = await callAPI('/api/ai/smart-query', 'POST', body);
            showResult('smart-result', result, 'æ™ºèƒ½æŸ¥è¯¢');
        }

        async function chatWithAI() {
            const message = document.getElementById('chat-message').value;
            const body = { message };
            const result = await callAPI('/api/ai/chat', 'POST', body);
            showResult('chat-result', result, 'AIèŠå¤©');
        }

        async function analyzeUserData() {
            const data = document.getElementById('analyze-data').value;
            const result = await callAPI('/api/ai/analyze-users', 'POST', data);
            showResult('analyze-result', result, 'AIæ•°æ®åˆ†æ');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è·å–ç³»ç»Ÿä¿¡æ¯
        window.onload = function() {
            getSystemInfo();
        };

       

        // å·¥å…·åŠŸèƒ½ï¼šæ¨¡å¼æ›¿æ¢é‡å‘½å
        async function renameByReplacement() {
            const dirPath = document.getElementById('replace-dir-path').value.trim();
            const pattern = document.getElementById('replace-pattern').value.trim();
            const replacement = document.getElementById('replace-replacement').value.trim();
            if (!dirPath || !pattern) {
                alert('è¯·è¾“å…¥ç›®å½•è·¯å¾„å’ŒåŒ¹é…å­—ç¬¦ä¸²');
                return;
            }
            const body = { dirPath, pattern, replacement };
            const result = await callAPI('/api/tools/rename-by-replacement', 'POST', body);
            if (result.success && result.data.success) {
                let html = `<h3>æ›¿æ¢é‡å‘½åç»“æœï¼ˆå…±${result.data.total}é¡¹ï¼‰ï¼š</h3><ul>`;
                result.data.list.forEach(item => {
                    const status = item.success === 'true' ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥';
                    html += `<li><strong>${item.type}</strong>: ${item.old} â†’ ${item.new} [${status}${item.error ? 'ï¼Œ' + item.error : ''}]</li>`;
                });
                html += '</ul>';
                showResult('replace-result', { success: true, data: html }, 'æ‰¹é‡æ›¿æ¢é‡å‘½å');
            } else {
                showResult('replace-result', result, 'æ‰¹é‡æ›¿æ¢é‡å‘½å');
            }
        }

        // è‚¡ç¥¨é€‰è‚¡
        function getStockPicks() {
            fetch('/api/stock/select')
                .then(res => res.json())
                .then(data => {
                    let html = '';
                    if (data && data.length > 0) {
                        html += '<ul>';
                        data.forEach((item, idx) => {
                            html += `<li>${idx + 1}. ${item.stock ? item.stock.name + 'ï¼ˆ' + item.stock.code + 'ï¼‰' : ''} - ${item.reason}</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html = 'æ— ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨';
                    }
                    document.getElementById('stock-pick-result').innerHTML = html;
                    document.getElementById('stock-pick-result').style.display = 'block';
                })
                .catch(() => {
                    document.getElementById('stock-pick-result').innerHTML = 'é€‰è‚¡å¤±è´¥';
                    document.getElementById('stock-pick-result').style.display = 'block';
                });
        }

        // è‚¡ç¥¨é£æ§
        function checkStockRisk() {
            const code = document.getElementById('risk-code').value.trim();
            const buyPrice = document.getElementById('risk-buy-price').value;
            const buyLow = document.getElementById('risk-buy-low').value;
            if (!code || !buyPrice || !buyLow) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            fetch('/api/stock/risk/check', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code, buyPrice: parseFloat(buyPrice), buyDayLow: parseFloat(buyLow) })
            })
            .then(res => res.json())
            .then(data => {
                let html = '';
                if (data.success) {
                    html = `<b>æ“ä½œå»ºè®®ï¼š</b> ${data.action}<br><b>åŸå› ï¼š</b> ${data.reason}<br><b>å½“å‰ä»·ï¼š</b> ${data.currentPrice}<br><b>æ”¶ç›Šç‡ï¼š</b> ${data.profitPercent ? data.profitPercent.toFixed(2) : 0}%`;
                } else {
                    html = 'é£æ§æ£€æµ‹å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯');
                }
                document.getElementById('stock-risk-result').innerHTML = html;
                document.getElementById('stock-risk-result').style.display = 'block';
            })
            .catch(() => {
                document.getElementById('stock-risk-result').innerHTML = 'é£æ§æ£€æµ‹å¤±è´¥';
                document.getElementById('stock-risk-result').style.display = 'block';
            });
        }
    </script>
</body>
</html> 